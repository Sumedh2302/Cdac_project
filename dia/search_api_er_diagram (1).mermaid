graph TB
    subgraph "MongoDB Database: searchapi"
        
        subgraph "Collection: cached_queries"
            CQ["ğŸ“„ cached_queries<br/>@Document(collection = 'cached_queries')"]
            CQ_FIELDS["ğŸ”‘ _id: ObjectId (PK)<br/>ğŸ“ query: String<br/>ğŸ“‹ results: List&lt;SearchResult&gt;<br/>ğŸ“… createdAt: Date<br/><br/>ğŸ” Index: { query: 1 }<br/>â° TTL Index: { createdAt: 1 }"]
            CQ --> CQ_FIELDS
        end
        
        subgraph "Collection: cached_image_query"
            CIQ["ğŸ“„ cached_image_query<br/>@Document(collection = 'cached_image_query')"]  
            CIQ_FIELDS["ğŸ”‘ _id: ObjectId (PK)<br/>ğŸ“ query: String<br/>ğŸ“‹ results: List&lt;ImageSearchResult&gt;<br/>ğŸ“… createdAt: Date<br/><br/>ğŸ” Index: { query: 1 }<br/>â° TTL Index: { createdAt: 1 }"]
            CIQ --> CIQ_FIELDS
        end
        
        subgraph "Collection: search_results"
            SR["ğŸ“„ search_results<br/>@Document(collection = 'search_results')"]
            SR_FIELDS["ğŸ”‘ _id: ObjectId (PK)<br/>ğŸ“ query: String<br/>ğŸ“ title: String<br/>ğŸ”— url: String<br/>ğŸ“ description: String<br/>ğŸ“ source: String<br/>ğŸ”¢ originalRank: int<br/>â­ score: double<br/><br/>ğŸ” Indexes:<br/>{ query: 1 }<br/>{ url: 1 }<br/>{ score: -1 }"]
            SR --> SR_FIELDS
        end
        
        subgraph "Embedded Document Schema"
            
            subgraph "SearchResult (Embedded in cached_queries)"
                ESR["SearchResult {<br/>ğŸ“ query: String<br/>ğŸ“ title: String<br/>ğŸ”— url: String<br/>ğŸ“ description: String<br/>ğŸ“ source: String<br/>ğŸ”¢ originalRank: int<br/>â­ score: double<br/>}"]
            end
            
            subgraph "ImageSearchResult (Embedded in cached_image_query)"
                EISR["ImageSearchResult {<br/>ğŸ“ title: String<br/>ğŸ–¼ï¸ imgUrl: String<br/>ğŸ“ source: String<br/>}"]
            end
        end
        
        subgraph "Spring Data Repositories"
            REPO1["CachedQueryRepository<br/>extends MongoRepository&lt;CachedQuery, String&gt;<br/><br/>Methods:<br/>â€¢ findByQuery(String query): Optional&lt;CachedQuery&gt;<br/>â€¢ save(CachedQuery): CachedQuery<br/>â€¢ findAll(): List&lt;CachedQuery&gt;"]
            
            REPO2["CachedImageQueryRepository<br/>extends MongoRepository&lt;CachedImageQuery, String&gt;<br/><br/>Methods:<br/>â€¢ findByQuery(String query): Optional&lt;CachedImageQuery&gt;<br/>â€¢ save(CachedImageQuery): CachedImageQuery<br/>â€¢ findAll(): List&lt;CachedImageQuery&gt;"]
        end
        
        subgraph "Data Types & Constraints"
            CONSTRAINTS["ğŸ“‹ Data Types:<br/>â€¢ ObjectId: MongoDB primary key<br/>â€¢ String: Text fields (indexed for search)<br/>â€¢ Date: Timestamp fields<br/>â€¢ int: Numeric ranking<br/>â€¢ double: Scoring values<br/>â€¢ List&lt;T&gt;: Embedded document arrays<br/><br/>ğŸ”’ Constraints:<br/>â€¢ @Id: Primary key annotation<br/>â€¢ @Document: Collection mapping<br/>â€¢ Lombok @Getter/@Setter: Auto-generated accessors"]
        end
    end
    
    subgraph "External Dependencies"
        SPRING["ğŸ Spring Data MongoDB<br/>â€¢ Auto-configuration<br/>â€¢ Repository pattern<br/>â€¢ Query method generation"]
        LOMBOK["ğŸŒ¶ï¸ Lombok<br/>â€¢ @Getter/@Setter<br/>â€¢ Reduces boilerplate code"]
        JACKSON["ğŸ”„ Jackson<br/>â€¢ JSON serialization<br/>â€¢ HTTP response mapping"]
    end
    
    %% Connections
    CQ_FIELDS -.->|embeds| ESR
    CIQ_FIELDS -.->|embeds| EISR
    
    REPO1 -.->|manages| CQ
    REPO2 -.->|manages| CIQ
    
    CQ -.->|uses| SPRING
    CIQ -.->|uses| SPRING
    SR -.->|uses| SPRING
    
    ESR -.->|serialized by| JACKSON
    EISR -.->|serialized by| JACKSON
    
    %% Styling
    classDef collection fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef embedded fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px  
    classDef repository fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef constraint fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef external fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class CQ,CIQ,SR collection
    class ESR,EISR embedded
    class REPO1,REPO2 repository
    class CONSTRAINTS,CQ_FIELDS,CIQ_FIELDS,SR_FIELDS constraint
    class SPRING,LOMBOK,JACKSON external